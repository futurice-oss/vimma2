<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-elements/core-elements.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">

<link rel="import" href="../create-vm/create-vm.html">
<link rel="import" href="../error-display/error-display.html">
<link rel="import" href="../vm-list/vm-list.html">
<link rel="import" href="../ajax-frag-splitter/ajax-frag-splitter.html">

<polymer-element name="project-detail" attributes="prjid frag">
  <template>
    <link rel="stylesheet" type="text/css" href="/static/vimma/components/bower_components/bootstrap/dist/css/bootstrap.min.css">

    <ajax-frag-splitter id="ajaxFrag" frag="{{frag}}">
    </ajax-frag-splitter>

    <template if="{{loading}}">
      Loadingâ€¦
    </template>

    <template if="{{!loading}}">
      <template if="{{!success}}">
        <error-display text={{errorText}}></error-display>
      </template>

      <template if="{{success}}">
        <template bind ref="main">
        </template>
      </template>
    </template>

    <template id="main">
      <h1>Project {{model.name}}</h1>
      <paper-tabs selected="{{selectedTabIdx}}">
        <template repeat="{{tab in tabs}}">
          <paper-tab>{{tab.title}}</paper-tab>
        </template>
      </paper-tabs>

      <template if="{{$.ajaxFrag.head == tabs[0].key}}">
        <template bind ref="vm-list"></template>
      </template>

      <template if="{{$.ajaxFrag.head == tabs[1].key}}">
        <template bind ref="user-list">
        </template>
      </template>
    </template>

    <template id="user-list">
      <h1><show-count n="{{users.length}}" name="user"></show-count></h1>
      <template repeat="{{u in users}}">
        <core-item label="{{u.first_name + ' ' + u.last_name}}">
        </core-item>
      </template>
    </template>

    <template id="vm-list">
      <template if="{{!showCreateVMComponent}}">
        <button type="button" class="btn btn-primary"
            on-click="{{toggleCreateVM}}">
          <span class="glyphicon glyphicon-plus"></span>
          Create VM
        </button>
      </template>
      <template if="{{showCreateVMComponent}}">
        <create-vm initialProjectId="{{prjid}}" showCloseBtn
          on-vm-created="{{reload}}" on-cancel-create-vm="{{toggleCreateVM}}">
        </create-vm>
      </template>

      <h1>Showing {{vms.length}} VMs</h1>

      <vm-list vmids="{{vmIds}}" frag="{{$.ajaxFrag.tail}}"></vm-list>
    </template>
  </template>

  <script src="project-detail.js"></script>
</polymer-element>
