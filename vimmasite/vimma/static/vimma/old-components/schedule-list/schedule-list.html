<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-elements/core-elements.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">

<link rel="import" href="../ajax-state/ajax-state.html">
<link rel="import" href="../error-display/error-display.html">
<link rel="import" href="../schedule-editor/schedule-editor.html">

<polymer-element name="schedule-list">
  <template>
    <link rel="stylesheet" type="text/css" href="/static/vimma/components/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="schedule-list.css">

    <ajax-state id="ajax"></ajax-state>

    <template if="{{loading}}">
      Loadingâ€¦
    </template>

    <template if="{{!$.ajax.inProgress && !$.ajax.success}}">
      <br>
      <error-display text="{{$.ajax.errorText}}"></error-display>
    </template>

    <template if="{{!loading && loadingSucceeded}}">
      <template bind ref="create-schedule"></template>
      <template bind ref="schedule-list"></template>
    </template>


    <template id="schedule-list">
      <h1>
        Showing {{schedules.length}}
        {{schedules.length == 1 ? 'schedule' : 'schedules'}}
      </h1>

      <ul id="schedules">
        <template repeat="{{schedule, idx in schedules}}">
          <li>
            <schedule-editor schedule="{{schedule}}" timezones="{{timezones}}"
              arrayIdx="{{idx}}" on-schedule-deleted="{{scheduleDeleted}}">
            </schedule-editor>
          </li>
        </template>
      </ul>
    </template>

    <template id="create-schedule">
      <template bind ref="create-schedule-collapsed"
        if="{{!showCreateSchedule}}">
      </template>
      <template bind ref="create-schedule-expanded"
        if="{{showCreateSchedule}}">
      </template>
    </template>

    <template id="create-schedule-collapsed">
      <button type="button" class="btn btn-primary"
          on-click="{{toggleCreateSchedule}}">
        <span class="glyphicon glyphicon-plus"></span>
        Create Schedule
      </button>
    </template>

    <template id="create-schedule-expanded">
      <div>
        <span id="create-close" title="Cancel"
          on-click="{{toggleCreateSchedule}}"
          class="glyphicon glyphicon-remove"></span>

        <h1>Create a new Schedule</h1>

        <div class="input-holder">
          <paper-input-decorator label="New schedule name" floatingLabel="{{true}}"
            error="The name may not be empty" isInvalid="{{!newScheduleName}}"
            disabled?="{{$.ajax.inProgress}}">
            <input is="core-input" value="{{newScheduleName}}">
          </paper-input-decorator>
        </div>
        <br>
        <paper-dropdown-menu label="Select a TimeZone">
          <paper-dropdown class="dropdown">
            <core-menu class="menu" selected="{{tzIdx}}">
              <template repeat="{{tz in timezones}}">
                <paper-item>{{tz.name}}</paper-item>
              </template>
            </core-menu>
          </paper-dropdown>
        </paper-dropdown-menu>
        <br>
        <paper-button id="create" raised
          on-click={{create}} disabled?="{{$.ajax.inProgress}}"
          class="{{ {highlight: newScheduleName.length && newScheduleTimeZone != null} | tokenList }}">
          <core-icon icon="create"></core-icon>
          Create
        </paper-button>
      </div>
    </template>
  </template>

  <script src="schedule-list.js"></script>
</polymer-element>
