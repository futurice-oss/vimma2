<link rel="import" href="/static/bower_components/polymer/polymer.html">

<link rel="import" href="/static/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/static/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/static/bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="/static/bower_components/iron-form/iron-form.html">

<link rel="import" href="/static/bower_components/paper-button/paper-button.html">
<link rel="import" href="/static/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/static/bower_components/paper-input/paper-input.html">
<link rel="import" href="/static/bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="/static/bower_components/paper-toggle-button/paper-toggle-button.html">

<link rel="import" href="../equal-behavior/equal-behavior.html">
<link rel="import" href="../plain-text/plain-text.html">
<link rel="import" href="matrix-editor.html">

<dom-module id="schedule-detail">
  <link rel="import" type="css" href="../../css/component-common.css">
  <link rel="import" type="css" href="schedule-detail.css">

  <template>
    <iron-ajax
      auto
      id="ajax-schedule"
      url="[[_scheduleUrl]]"
      handle-as="json"
      last-response="{{schedule}}">
    </iron-ajax>

    <iron-ajax
      auto
      id="ajax-timezone"
      url="[[_tzUrl]]"
      handle-as="json"
      last-response="{{timezones}}">
    </iron-ajax>

    <template is="dom-if" if="[[_error]]">
      <plain-text class="error" text="[[_error]]"></plain-text>
    </template>

    <div id="summary" on-click="toggle">
      <span id="summary-name">[[schedule.name]]</span>
      <span id="summary-timezone">[[_tzName(timezones.results, schedule.timezone)]]</span>

      <iron-ajax
        id="deleteButtonAjax"
        method="DELETE"
        url="[[_scheduleUrl]]"
        headers$="[[csrfTokenHeader()]]">
        <paper-icon-button icon="delete" title="Delete" on-click="_delete">
        </paper-icon-button>
      </iron-ajax>

    </div>

    <iron-collapse id="collapse">
      <div id="details">
      <form is="iron-form" id="form" method="post" content-type="application/json" action="[[_scheduleUrl]]">

        <paper-input
          name="name"
          value="{{schedule.name}}"
          label="Name"
          required
          auto-validate
          error-message="The name may not be empty">
        </paper-input>

        <label for="tz-select">Timezone</label>
        <select id="tz-select" name="timezone" on-change="timezoneSelected">
          <template is="dom-repeat" items="[[timezones.results]]">
            <option value="{{item.id}}" selected$="[[_equal(item.id, schedule.timezone)]]">[[item.name]]</option>
          </template>
        </select>

        <matrix-editor value="{{schedule.matrix}}"></matrix-editor>

        <paper-toggle-button id="is-special" name="is_special" checked="{{schedule.is_special}}"></paper-toggle-button>

        <label for="is-special">
          Using this schedule requires special permissions
        </label>

        <paper-button id="save" raised on-click="submitForm">
          <iron-icon icon="save"></iron-icon>
          Save
        </paper-button>

        <paper-button id="discard" raised on-click="_discardChanges">
          <iron-icon icon="undo"></iron-icon>
          Undo changes
        </paper-button>

      </form>
      </div>
    </iron-collapse>

  </template>
</dom-module>

<script src="schedule-detail.js"></script>
