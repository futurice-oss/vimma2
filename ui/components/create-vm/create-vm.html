<link rel="import" href="/static/bower_components/polymer/polymer.html">

<link rel="import" href="/static/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/static/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/static/bower_components/paper-button/paper-button.html">
<link rel="import" href="/static/bower_components/paper-input/paper-input.html">
<link rel="import" href="/static/bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../equal-behavior/equal-behavior.html">
<link rel="import" href="../loading-overlay/loading-overlay.html">
<link rel="import" href="../plain-text/plain-text.html">
<link rel="import" href="create-vm-aws-data.html">
<link rel="import" href="create-vm-dummy-data.html">

<!--
  Create a new VM.

  After creating the VM it fires the event ‘vm-created’.
-->

<dom-module id="create-vm">
<link rel="import" type="css" href="../../css/component-common.css">
<link rel="import" type="css" href="create-vm.css">
<template>
  <paper-button
    id="expand"
    hidden$="[[_expanded]]"
    raised on-click="_toggle">
    <iron-icon icon="add"></iron-icon>
    Create VM
  </paper-button>

  <iron-ajax
    auto
    id="projects"
    url="[[projectsUrl]]"
    last-response="{{projects}}">
  </iron-ajax>

  <iron-ajax
    auto
    id="providers"
    url="[[providersUrl]]"
    last-response="{{providers}}">
  </iron-ajax>

  <iron-ajax
    auto
    id="configs"
    url="[[configsUrl]]"
    last-response="{{configs}}">
  </iron-ajax>

  <iron-ajax
    auto
    id="schedules"
    url="[[schedulesUrl]]"
    last-response="{{schedules}}">
  </iron-ajax>

  <template is="dom-if" if="[[_expanded]]">
    <div id="expanded">
      <paper-icon-button id="close" icon="close" on-click="_toggle">
      </paper-icon-button>

      <h1>Create a new VM</h1>

      <plain-text class="error" text="[[_loadErr]]"></plain-text>
      <div hidden$="[[!_createError]]">
        <plain-text class="error" text="[[_createError]]"></plain-text>
      </div>

      <table id="form">
        <tr>
          <td>
            <label for="prj">Project:</label>
          </td>
          <td>
            <select id="prj" on-change="projectSelected">
              <template is="dom-repeat" items="[[projects.results]]">
                <option selected$="[[_equal(item, _selPrj)]]"
                  >[[item.name]]</option>
              </template>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <label for="provider">VM Provider:</label>
          </td>
          <td>
            <select id="provider" on-change="_providerSelected">
              <template is="dom-repeat" items="[[providers.results]]">
                <option selected$="[[_equal(item, _selProvider)]]"
                  >[[item.name]]</option>
              </template>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <label for="vmcfg">VM Configuration:</label>
          </td>
          <td>
            <select id="vmcfg" on-change="_vmcfgSelected">
              <template is="dom-repeat" items="[[_vmcfgsForProvider]]">
                <option selected$="[[_equal(item, _selVmcfg)]]"
                  >[[item.name]]</option>
              </template>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <label for="schedule">Schedule:</label>
          </td>
          <td>
            <select id="schedule" on-change="_scheduleSelected">
              <template is="dom-repeat" items="[[schedules.results]]">
                <option selected$="[[_equal(item, _selSchedule)]]">[[item.name]]</option>
              </template>
            </select>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <paper-input
              label="Comment"
              placeholder="What is this VM for?"
              value="{{_comment}}"
              ></paper-input>
          </td>
        </tr>
      </table>

      <template is="dom-if" if="[[_equal(_selProvider.type, 'dummy')]]" restamp>
        <create-vm-dummy-data data="{{_data}}"></create-vm-dummy-data>
      </template>
      <template is="dom-if" if="[[_equal(_selProvider.type, 'aws')]]" restamp>
        <create-vm-aws-data data="{{_data}}"></create-vm-aws-data>
      </template>

      <paper-button id="create" raised on-click="_create">
        <iron-icon icon="create"></iron-icon>
        Create
      </paper-button>
    </div>
  </template>

</template>
</dom-module>

<script src="create-vm.js"></script>
